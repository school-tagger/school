

Правительство Российской Федерации



Федеральное государственное автономное образовательное учреждение высшего профессионального образования



"Национальный исследовательский университет 
"Высшая школа экономики"



Факультет Мировой экономики и мировой политики

Кафедра Международных валютно-финансовых отношений







ВЫПУСКНАЯ КВАЛИФИКАЦИОННАЯ РАБОТА





На тему: «Прогноз валютного курса на основе рыночной микроструктуры: моделирование динамики фьючерса на валютную пару доллар-рубль»







Студент группы №М26МФ

Чукаловский Никита Александрович



Научный руководитель

к.э.н. Камротов Михаил Владимирович



Консультант

д.э.н. Евстигнеев Владимир Рубенович











Москва, 2014 г.


Содержание

 


































Введение 

В условиях восстановления после кризиса 2008-09 гг. мировой финансовый рынок снова идёт по пути стремительного развития, предлагая всё больше инноваций для различных участников и совершенствуя механизмы международного движения капитала. При этом основной вектор развития остался прежним – это всеобщий переход к электронной торговле. 

Повсеместное внедрение алгоритмов в торговле финансовыми инструментами нацелено прежде всего на достижение большей эффективности рынка. Ценная информация отражается в ценах практически мгновенно, а электронные системы исполнения приказов способствуют росту ликвидности, что облегчает задачу управления финансовыми рисками. Процессы трансформации ускоряют так называемые высокочастотные (high-frequency, HF) трейдеры, и их действия, в особенности после резкой просадки американских индексов 6 мая 2010 г. (The Flash Crash) вызывают серьезные споры как среди профессиональных участников рынка, в том числе суверенных регуляторов [1]. Однако несомненно, что на финансовых рынках новейшего времени счёт идёт на милли- , микро- и даже наносекунды [2, 3, 4]

Валютный рынок – самый ликвидный среди всех типов финансовых рынков [5]. В то же время высокая волатильность курсов валют и их систематическое отклонение от фундаментальных значений [6, с.58] свидетельствуют о следующем. Во-первых, при прогнозировании валютного курса как внутри дня, так и на более широкий временной горизонт необходимо учитывать специфику организации торговли: для валютного рынка характерна чрезвычайно высокая концентрация – всего 4 банка контролируют 75% торговли валютой [5], а структура рынка объединяет в себе множество посредников-дилеров, которые склонны в течение дня сводить валютную позицию к нулю [8, с.40]. И во-вторых, ход валютных торгов сам по себе информативен: трейдеры совершают действия на основе недоступных публике данных или исследований [6, с.6] или торгуют так, чтобы их действия стали «самосбывающимся прогнозом» [7, с.2]. Таким образом, исследователю, занимающемуся прогнозированием внутридневной курсовой динамики, важно располагать качественными микроструктурными данными торгов. 

В России валютный рынок имеет огромное значение для экономики: курс рубля находится в «управляемом плавании». Валютная пара доллар-рубль сегодня самый торгуемый инструмент на российском финансовом рынке, а его биржевая спецификация – фьючерс на курс – второй по популярности на рынке производных инструментов FORTS Московской Биржи [10], что делает его интересным объектом для исследования. 

Основная научная гипотеза настоящего исследования состоит в следующем: поведение участников рынка является определяющим фактором в формировании динамики цены фьючерса на валютную пару доллар-рубль. 

Предмет исследования – фьючерс на валютную пару доллар-рубль. Объект исследования – взаимосвязь динамики курса пары доллар-рубль, глубины рынка и потока рыночных и лимитных приказов.

Цель дипломной работы заключается в разработке механизма прогнозирования изменения цены фьючерса на курс доллар-рубль c учётом состояния и динамики ликвидности инструмента. В соответствии с целью в работе ставятся и решаются следующие задачи:

выявить эмпирические закономерности микроструктурных данных;

построить факторную модель ожидаемой интенсивности торгов с учётом эффекта взаимной отдачи притока и оттока ликвидности;

спрогнозировать изменение цены фьючерса на курс доллар-рубль как марковской цепи в непрерывном времени.

Научная новизна настоящего исследования состоит в том, что приток и отток ликвидности рассматриваются как единая нелинейная система. 

Теоретическая значимость работы заключается в том, что прогноз валютного курса формируется посредством прогноза действий участников рынка. Практическая значимость исследования состоит в том, что при помощи представленной в работе модели можно в реальном времени получать прогнозы изменения цен активов с учетом показателей рыночного риска и риска ликвидности.

Структура работы следующая. В главе 1 изложены теоретические предпосылки микроструктурной теории финансовых рынков. В главе 2 приведены описание входных данных и их эмпирический анализ. В главе 3 представлена модель изменения цены фьючерса на курс доллар-рубль с оценкой ожидаемой ликвидности и формируется прогноз динамики курса. В заключении подводятся итоги исследования.


1. Основы микроструктурного подхода

Рыночная микроструктура – это дисциплина финансового анализа, которая изучает механизмы формирования цен активов и их динамику как результат взаимодействия между участниками торгов [18, с.1027], имеющих различные стимулы для совершения сделок [19, с.4] на основе частной информации [6, c.4]. Это направление финансовой науки в ходе изучения принятия решений стремится количественно учесть реалии рынка, такие как трансакционные издержки, неоднородность его участников и институциональные особенности.



Современная структура рынка организованной торговли

Сегодня финансовые рынки переживают переход от централизованной системы к более фрагментированной. В конце 90-х – начале 2000-х главную роль на рынке организованной торговли долевыми инструментами и деривативами играли биржи, а на валютном рынке – междилерские сети. Современная торговля происходит в рамках более сложной, укрупнённой структуры, где приоритетом для профессиональных участников является минимизация трансакционных издержек, а также скорость и анонимность исполнения приказов. В результате технологического прогресса ликвидность становится товаром, который можно приобрести у огромного множества участников, тесно связанных между собой (см. Рис.1).

Основные связующие звенья сохранились, хотя и несколько сократили свою долю на рынке организации торговли. Биржа – это площадка для торговли стандартизированными контрактами с депозитарно-клиринговой палатой, которая гарантирует исполнение обязательств по контрактам, и механизмом исполнения приказов, соединяющим продавцов с покупателями. Брокеры занимаются торговлей финансовыми инструментами от имени клиентов, дилеры агрегируют заявки (ордера) клиентов в книгах и торгуют большими лотами через биржи или междилерские сети. 

В настоящий момент всё большую роль играют так называемые сети ECN (Electronic Crossing Networks). Данные пулы ликвидности посредством сложных алгоритмов находят наилучшую цену (наименьшую цену покупки и наибольшую цену продажи) среди всех подключеённых к ним участников. Также растёт популярность так называемых Dark pools, которые обеспечивают анонимность при постановке приказа на покупку или продажу. 

Структура рынка капитала усложняется по нескольким причинам. Инновации в сфере телекоммуникации и тенденция в сторону дерегулирования финансовых рынков на законодательном уровне (в первую очередь, в США, где  привели к появлению новых ниш. Благодаря высокоскоростному доступу к данным с различных торговых площадок профучастники могут быстрее узнавать всю необходимую информацию и мгновенно реагировать на изменение рыночной конъюнктуры. HF-трейдеры (HFT), которые совершают множество сделок внутри дня [12, c.45], соревнуются в скорости, и для обслуживания их интересов создаются новые сетевые решения (напр., co-location – прямой доступ к биржевым данным). Однако ускорение хода торгов приводит и к тому, что заинтересованные в покупке или продаже большого объёма бумаг участники, такие как институциональные инвесторы и обеспеченные индивиды (High-net-worth individuals, HNWI), вынуждены искать альтернативные решения, вне бирж, брокеров и инвестиционных банков.

Большую опасность для крупных фирм представляет HFT-манипулирование ценой. Так, HFT склонны значительно сокращать ликвидность в периоды неопределённости, что провоцирует её нехватку и вызывает резкое падение котировок [13]. Особенно много вреда крупным игрокам приносят стратегии ожидания приказов (order anticipation) [14, c.245], стоящих на вооружении у HFT. Другие виды манипулирования ценой включают отрицательные затраты на исполнение (round-trip) [15], искусственный перекос ликвидности (spoofing), обеспечение приоритета исполнения (layering) и постановка не подлежащего реализации крупного приказа (order over-sizing) [7].

В то же время всё больше валюты обращается именно на биржах. Ярким примером служит запуск валютных контрактов на Чикагской бирже [16]. Таким образом, в рамках исследования представляется интересным выяснить с помощью микроструктурных данных, защищены ли трейдеры от манипуляций.



Специфика микроструктурных данных

Главным отличием микроструктурного финансового анализа от традиционных видов, фундаментального и технического, является то, что в нём используются внутридневные данные о ходе торгов вплоть до уровня отдельных приказов и сделок с точностью до долей секунды.

В микроструктурном анализе различают три типа данных – нулевого, первого и второго уровня (Level-0, I, II data), где уровни растут по мере увеличения количества рыночной информации. Нулевой уровень – это арифметическое среднее цен покупки и продажи (midprice). Первый уровень, сделок и котировок (Trades and Quotes, TAQ), включает в себя цену сделки и её объём (trade), а также лучшие цены – цену покупки (bid), цену продажи (ask), и соответствующее этим ценам количество – всё вместе котировка (quote). Данные второго уровня включают не только сделки и лучшие цены-количество, но и всю книгу заявок, стакан (limit order book), содержащий в себе информацию о том, сколько контрактов можно купить или продать и по какой цене. Динамика торгового процесса выражается в изменении стакана заявок, функционирование которого схематически приведено на Рис.2.

Если по инструменту доступны данные стакана, то это означает, что торги проходят в форме двойного аукциона. Основные типы приказов – лимитные (limit order) и рыночные (market order). Приказ является рыночным, если участник желает купить или продать определённый объём контрактов по лучшей цене в данный момент. В лимитном приказе трейдер указывает и объём сделки, и желаемую цену, и если цена бид (аск) оказывается больше (меньше) или равен цене аск (бид) на данный момент, то этот приказ идентичен рыночному, в противном случае его цена становится в соответствующую очередь. Приоритет реализации приказов может быть различным [7, 20], но большинство площадок, в том числе FORTS, приняли формат «цена-время» (price-time priority): сначала удовлетворяются заявки по относительно лучшим ценам, а внутри цены – сначала заявки, поступившие раньше других. Совокупный объем спроса и предложения называется глубиной рынка (depth).

В целом, микроструктурные данные дают возможность исследователю извлечь информацию о мотивах действий профессиональных участников рынка. 



Направления микроструктурного анализа

Авторы научных работ по рыночной микроструктуре, как правило, ставят перед собой две цели – объяснить происходящие явления и/или спрогнозировать потенциальное развитие событий на рынке. Подходы же к изучению рынка различные, и литературу можно условно разделить на две категории: эмпирический анализ и моделирование ликвидности, где в рамках последней определяется торговый процесс в целом, а также решается задача оптимального исполнения приказов (optimal order execution problem).

Эмпирические исследования преобладают в литературе. Именно на их основе фиксируются рыночные закономерности в данных по книге заявок и сделкам. Примечательно, что эмпирические наблюдения не однородны как во времени, так и по площадкам или финансовым инструментам [20]. Однако большинство авторов сходятся на ограниченном количестве «стилизованных фактов». В частности, рынок характеризуется тем, что большинство лимитных ордеров снимается из книги заявок [21, 22], причём доля варьируется в пределах 75-99% от всех приказов [20, с.13]. Максимальное число лимитных приказов приходится на лучшие цены [23, 25, 26]. Исходя из динамики постановки приказов следует, что профиль книги заявок характеризуется наличием «горба» возле лучших цен (hump-shaped), т.е. объём сначала резко растет при удалении от бида и аска, а затем постепенно снижается [23, 24]. Из снимка стакана можно получить графики избыточного спроса и предложения, которые отражают потенциальное влияние рыночного приказа на цену [27]. Также обсуждается значение ликвидности в определении волатильности: гэпы в стакане могут спровоцировать прыжки цен [39], а расширение спреда ведет к более пассивному участию в торгах через постановку лимитных приказов (в противоположность к рыночным, т.е. потреблению ликвидности) [22, 40]. 

Большое внимание уделяется также анализу потоков приказов во времени: события (3 типа: сделка – рыночный приказ, постановка и снятие лимитного ордера) скоррелированы во времени и между собой [22, 25], кластеризуются соответственно различным режимам активности [28, 29] и демонстрируют эффект взаимной отдачи (feedback effect) с изменением цены [30, 36]. Важно подчеркнуть наличие положительной связи доходности с дисбалансом лимитных приказов, однородной по времени [31] и с лагом [32], и чистого реализованного спроса (разница числа рыночных покупок и продаж, trade imbalance), как с лагом и без по разнице приказов [33, 34]. В работах по микроструктуре валютного рынка строятся микро-макро модели динамики курсов, где чистому купленному объёму приписывается роль поставщика частной информации на рынок [33, 35]. Стоит отметить, что в [37] авторы не обнаруживают преимущества доступности данных по глубине рынка и торгам в прогнозировании изменения курса GBPUSD. Однако актуальность темы стратегического поведения участников рынка, т.е. анализа их потоков приказов, только растёт со временем. Так, профучастники исследуют, насколько рынок чувствителен к их потоку приказов [41], чтобы выявить скрытые ордера – «айсберги», и их стратегии всё чаще используют быструю постановку и снятие лимитных ордеров в связке (strategic runs) [2]. Поставщики ликвидности, маркет-мейкеры, в качестве которых все чаще выступают HFT [42], склонны сводить позицию к нулю в конце дня [8], а дилеры перекладывают риск нежелательной позиции на другого дилера (hot-potato problem) [6]. 

Хотя интересы потребителей и поставщиков ликвидности на рынке, как правило, различны, для обеих сторон важно прогнозировать динамику торгов. Чтобы снизить риски торговли против информированного участника и снизить издержки содержания запасов, поставщикам ликвидности необходимо уметь предсказывать объем и время постановки приказов. Тем, кому нужно занять определённую позицию, важно знать, на какой объём они могут рассчитывать и в какое время его можно будет купить или продать с наименьшим влиянием на рынок (market impact) и минимальными транзакционными издержками [50, 51, 52, 53]. Поэтому остро стоит проблема прогнозирования ликвидности. 

Данную задачу решают различными методами: эконометрическими, где строятся регрессионные модели условной интенсивности [29, 30]; непараметрическими, которые предполагают факторное разложение кривой спроса и предложения [32], и стохастическими, где интенсивность потока есть случайный процесс [43, 44]. Более продвинутые модели представляют торги как условно-конечномерную марковскую цепь в непрерывном времени [55] или как систему массового обслуживания (СМО, queueing system). Из СМО можно извлечь параметры эффективности её работы, такие как вероятность исполнения определенного объема или его ожидаемое время реализации приказа [45, 7]. И хотя прогнозирование цены по динамике ликвидности осуществляется с помощью распознавания образов [4, 54], на основе анализа СМО есть возможность получить вероятностные характеристики движения цены [46, 48, 49]. Большинство моделей СМО предполагает скалярные интенсивности, т.е. пуассоновскую спецификацию потоков, но существуют и функциональные модификации [46, 47]. 

Таким образом, при постановке задачи прогнозирования валютного курса на основе микроструктуры рынка необходимо сначала проверить наличие эмпирических закономерностей, и затем на их основе представить вероятностную картину изменения курса. 


2. Эмпирический микроструктурный анализ

Микроструктурный анализ финансовых рынков проводится на стыке экономических и институциональных предпосылок и факторов, влияющих на механизм формирования массовых субъективных ожиданий. В ходе торгов желания и настрой игроков воплощаются в приказы купить или продать активы. Следовательно, ценовой процесс нужно рассматривать не только как закон изменения стоимости инструмента: важно также учитывать изменение ликвидности на рынке. Характер ценового процесса уникален для каждого актива, а значит и динамика торгов имеет свои особенности.



2.1.	Данные

Для анализа был выбран фьючерс на курс валютной пары доллар-рубль, Si-6.14. Дата исполнения фьючерса – 16.06.2014, базисный актив – курс доллара с поставкой на завтра (USDRUB_TOM). В качестве цены исполнения «принимается значение фиксинга на рубль, определенное в день исполнения контракта на основании усредненных цен сделок и заявок, рассчитанных посекундно за период 12:25:01 – 12:30:00 МСК включительно, умноженное на количество долларов США в лоте». Лот контракта – 1000, котировка выражается в рублях за лот. 

Данные включают в себя все стаканы заявок (40 позиций, по 20 лучших цен покупки и продажи) и рыночные сделки за 24.04.2014, с проставленной временной меткой с точностью до миллисекунд. Источник данных – сервер терминала «Альфа-директ», к которому была подключена авторская программа сбора данных, написанная на основе методов открытого интерфейса терминала.



На Рис.3 изображен график изменения цены Si-6.14 (midprice) за 24 апреля 2014 г. По графику видно, что на рынке выделяются периоды различной активности (режимы), в ходе которых цена изменяется быстрее или медленнее. Этот факт наглядно демонстрирует шкала событий на верхней горизонтальной оси: она показывает, что число изменений стакана непропорционально времени. При этом цена может и колебаться возле равновесного уровня (как в вечернюю сессию с 20:00 до закрытия) и резко переходить из одного «коридора» в другой (как с момента открытия до 12:00). 



2.2.	Описательная статистика хода торгов

Эмпирический анализ ликвидности актива начинается с рассмотрения общей картины, то есть агрегированной статистики за весь день торгов. 

Участникам рынка важно извлекать информацию о спросе и предложении. И если цена инструмента – это уже результат взаимодействия продавцов и покупателей, то картина потенциального изменения цены формируется в книге заявок: по ней можно построить кривые избыточного спроса и предложения следующим образом:



где – накопленный объём в стакане до позиции i со стороны , b – приказы на покупку (bid), a – на продажу (ask),  – объём напротив цены i. Следовательно,  – это избыточный спрос, – избыточное предложение.

Наклон кривых отражает мгновенную эластичность, т.е. показывает как изменится цена при изменении количества на заданную величину. Фактически, эластичность есть не что иное, как ожидаемое влияние на цену (virtual price impact, vpi) [27]. Следовательно, из функций избыточного спроса и предложения можно получить функции потенциального влияния на цену, которые демонстрируют, на сколько пунктов изменится цена мгновенно при покупке или продаже определённого числа контрактов в данный момент (см. Рис.4). 

На Рис.4 (слева) изображена усреднённая картина ожидаемого влияния на цену, где в качестве средней точки выбрана медиана (выделена чёрным цветом), а показателем разброса выступает межквартильный размах (разница 3его и 1ого квартилей, прямоугольник). Из анализа по всей книге заявок следует, что влияние на цену мгновенного потребления ликвидности не линейно. В силу того, что структура ликвидности в стакане неоднородна, влияние на цену одного и того же количества контрактов в различные моменты времени будет различным. Следовательно, принятие решения о покупке или продаже фьючерса предполагает аккуратный выбор момента постановки заявки. 

Очевидно, что при реализации слишком большого объёма легко выбить цену из равновесия. Данное наблюдение может служить объяснением того, почему участники рынка склонны разбивать крупный объём на множество мелких заявок. С помощью разбивки объема (order splitting) можно добиться исполнения приказа с меньшими трансакционными издержками. Это подтверждают границы разброса (здесь минимальный и максимальный накопленный объём, отрезок) на правой части Рис.4: в течение дня возникали определённые моменты, когда было доступно весьма большое количество контрактов по ценам в пределах 5 пунктов от лучших. Стоит отметить, что медианное количество напротив лучших цен составляет 32 контракта с каждой стороны рынка при совокупном дневном объёме сделок в 1,3 млн контрактов.

Такая картина изменения спроса и предложения говорит о том, что при принятии решений необходимо принимать во внимание характеристики потенциальной реакции цены в зависимости от потребляемого объёма. Измерить её (vpi) можно с помощью степенного закона, 



где  – позиция в стакане относительно midprice,а c и vpi находятся по МНК.



На Рис.5 представлены первые четыре выборочных момента для объёмов напротив позиций в стакане. Профиль стакана горбовидный, что часто наблюдается в литературе по статистическому анализу книги заявок. Вследствие этого факта цена в среднем движется «в коридоре» между значениями, соответствующими максимальным объемам с каждой стороны, но если она выходит за рамки этого коридора, то влияние на цену только нарастает при большем потреблении ликвидности. Количество очень резко меняется, максимум также соответствует границам коридора, что говорит о его «плавающем» характере. Моменты высших порядков вблизи лучших цен свидетельствует о появлении объёмов, намного больше среднего по позиции.

Помимо глубины рынка как индикатора потенциального влияния на цену, ещё одним важным показателем состояния ликвидности является дисбаланс объёма лимитных приказов на покупку и продажу (см. Рис.6):





Рис.6 показывает, что при различном охвате стакана статистические характеристики дисбаланса приказов значительно различаются. Очевидно, что наиболее характерная ситуация – это отсутствие дисбаланса, как на правой части рисунка (50%-50%, или ), однако стремительное изменение лучших цен находит своё отражение в том, что дисбаланс здесь становится скорее правилом, чем исключением. Распределение для 20 позиций практически симметрично, и цена закрытия в итоге оказалась равной цене открытия.

Данный показатель полезен для определения настроения рынка. Чем больше , тем сильнее ожидания в сторону повышения цены, и наоборот. Однако перекосы могут создаваться искусственно с целью манипулирования рынком, поэтому его ценность для прогнозирования предстоит выяснить далее.

2.3.	Анализ динамики торгов

Рынок чрезвычайно изменчив. Потому большое значение имеет не только понимание общей ситуации на рынке, но и его анализ в динамике. Изменение ликвидности на рынке имеет форму событий – постановки (лимитных и рыночных) или снятия (только лимитных) приказов, или их притока и оттока.

Динамика притока и оттока ликвидности в первой позиции стакана, агрегированная за промежуток в 100 котировок, представлена на Рис.7. 

Рис.7 наглядно демонстрирует, что приток и отток стакана связаны как между собой, так и во времени, так и между различными сторонами рынка. Потоки кластеризуются в два режима: большие изменения следуют за большими и наоборот. Между притоком и оттоком ликвидности для одной стороны связь изменчива и нелинейна (см. Рис.8):



По Рис.8 (слева) можно наблюдать чётко выраженную положительную связь переменных в левом хвосте распределения (tail dependence), и менее значимую в правом хвосте. О формализме, позволяющем учесть эффект взаимной отдачи переменных, распределённых произвольным образом, пойдёт речь в следующей главе. Правая часть Рис.8 свидетельствует о том, что потоки скоррелированы во времени даже при агрегировании за 100 событий, и значение автокорреляции наибольшее возле лага с номером 1, что количественно подтверждает факт кластеризации событий.

Дисбаланс приказов принято рассматривать как индикатор настроения участников рынка. Когда на стороне покупателей скапливается относительно большое количество объёма (дисбаланс ближе к 1), то перед движением цены образуется барьер-поддержка, что снижает вероятность её падения. Обратная ситуация: если дисбаланс стремится к нулю, то получается зона сопротивления (см. Рис.9). В то же время, обратная корреляция дисбаланса и цены наблюдается не все время торгов, что говорит о неоднородном характере связи и мотивирует использование скользящих отрезков времени для анализа.



Таким образом, эмпирический анализ показывает, что рыночные характеристики тесно друг с другом взаимосвязаны и неоднородны во времени. Наиболее важными показателями книги лимитных заявок являются потенциальное влияние на цену (глубина рынка) и дисбаланс приказов.






3. Прогнозирование динамики фьючерса на USDRUB 

Цена фьючерса определяется в результате взаимодействия участников рынка с книгой лимитных приказов. Для решения задачи прогнозирования курса  необходимо ограничить пространство изменений стакана конечным числом состояний и задать его эволюцию на основе наблюдаемых параметров.



3.1.	Торги как цепь Маркова с непрерывным временем

Марковская цепь с непрерывным временем используется для моделирования динамики книги заявок. Пусть в стакане доступно n позиций с каждой стороны (продавцов и покупателей) соответственно ценам в порядке возрастания от лучших. Тогда стакан математически можно представить как 



где  – это накопленный объём лимитных приказов в момент времени t напротив цены с индексом  с индексом стороны s.

Книга заявок изменяется под воздействием рыночных приказов, а также постановок и отмен лимитных приказов. Определим набор состояний стакана и соответствующие интенсивности перехода следующим образом:

 		

где  есть увеличение (уменьшение) количества лимитных приказов на одну единицу. Таким образом, при рассмотрении N цен с каждой стороны s мы получим 2N состояний. Например, если книга заявок содержит только лучшие цены (TAQ), то размерность пространства состояний будет равна 4. Заметим, что такая формулировка задачи отлична от [46] и [55], где состояния стакана представлены как объём в момент времени t. На базе  можно составить матрицу интенсивностей (transition rate matrix), которая является генератором процесса и отвечает за скорость перехода из одного состояния в другое: 



где , а  определяются из балансового соотношения [56, с.397]:



где  – недиагональные элементы матрицы , соответствующие скоростям перехода из состояния k в состояние j. 

Из матрицы  можно извлечь следующую информацию. Например, состояние 1 – это постановка лимитного ордера на покупку 1 контракта по цене bid, состояние 2 – это ликвидация лимитного ордера на покупку 1 контракта по цене bid по причине его снятия или постановки рыночного ордера на продажу, а состояние N - это ликвидация лимитного ордера на продажу 1 контракта по цене, удалённой от цены ask на N позиций. В финансовой литературе принято разделять снятие заявки и постановку рыночных заявок, однако в данной работе соответственные частоты событий соединены в одну величину, означающую уменьшение количества контрактов, доступных по данной цене. Такое допущение не ограничивает анализ, поскольку состояние стакана изменяется ввиду притока и оттока ликвидности, что и отражено в матрице-генераторе . Процесс перехода между состояниями представлен на Рис.10 (в случае, если стакан содержит 2 позиции сверху и снизу относительно midprice)



На основе матрицы интенсивностей можно рассчитать переходные вероятности [56, с.397]:



где  – горизонт прогнозирования. Значение переходной вероятности интерпретируется как часть времени, которую процесс проведёт в данном состоянии на данном горизонте. При  вероятности сходятся к стационарному распределению , которое находится из системы линейных уравнений баланса (balance equations) с учётом условия нормировки:

 

Таким образом, задача прогнозирования сводится к нахождению интенсивностей перехода между различными состояниями системы.



3.2.	Моделирование ожидаемого потока заявок

Ранее в Главе 2 был сделан вывод, что приток и отток ликвидности не только определяются динамикой рыночных факторов, характер которой меняется во времени, но и что они не являются независимыми и одинаково распределёнными величинами. Следовательно, для построения прогноза динамики ликвидности потребуется гибкая модель, которая бы учитывала эффект взаимной отдачи переменных с изменяющимися статистическими характеристиками.

В качестве основы моделирования такого рода зависимостей используется формализм копул. Копула – это функция совместного распределения случайных величин, в которой предельные распределения являются стандартными равномерными. По теореме Скляра каждую многомерную функцию распределения  можно представить так [57]:



где  – предельные распределения случайных величин ,  – d-мерная копула, функция связки. Основным преимуществом данной модели является возможность произвольного выбора предельных распределений. Иными словами, копула позволяет получить совместное распределение случайных величин из различных генераторов, связанных друг с другом.

Тип функции связки определяется исходя из характера зависимости между рассматриваемыми переменными. Большое значение имеет ранговая корреляция в хвостах соответствующих предельных распределений, которая выполняет роль измерителя степени зависимости. В нашем случае, когда приток и отток ликвидности положительно зависят друг от друга в левом хвосте, и слабо положительно в правом, целесообразно взять копулу Клейтона [58]:



где  – предельные функции распределения, c – параметр связи распределений с областью определения . 

В рамках данного исследования мы проанализируем зависимость притока и оттока ликвидности по соответствующей позиции для bid и ask по отдельности. Это ограничивает возможность исследования взаимоотдачи двух сторон рынка, однако в то же время экономит число степеней свободы, а значит и скорость расчётов. Величины и  предполагаются распределёнными экспоненциально c параметрами p и q соответственно. Заметим, что в качестве априорного распределения интенсивностей обычно полагается гамма-распределение, которое имеет два параметра [59]. Следовательно, в случае двух предельных экспоненциальных распределений функция плотности с связкой Клейтона выглядит так:



где .

Прогнозные значения  оцениваются по следующей схеме:

Определить вектора факторов  и , для притока и оттока ликвидности соответственно, на скользящем отрезке длиной W в момент времени t и шагом M. W соответствует фиксированному числу изменений книги заявок (время измеряется в терминах событий стакана). Шаг M равен количеству наблюдений в скользящем отрезке;

Составить линейную комбинацию факторов и соответствующих им параметров β;

Задать условное среднее для полученного многомерного распределения в соответствии с теоретическими средними предельных экспоненциальных распределений:

		 		

Вывести функцию правдоподобия многомерной функции плотности вероятности, подставив вместо  и выражения из пункта 3;

Предполагая  равными эмпирическим значениям, оценить параметры β и c путём максимизации функции правдоподобия:



На основе оценённых параметров и текущих значений факторов определить прогнозные значения параметров интенсивности ;

При появлении [1, W] новых событий пересчитать  с прежними β;

При наступлении W событий переоценить параметры, следуя пунктам 1-5 алгоритма.

Полученные интенсивности перехода между состояниями равны числу соответствующих событий в единицу времени, которое в данной работе исчисляется в изменениях стакана. Важно, что с помощью приведенного выше алгоритма можно получить не только прогноз значений параметров интенсивностей, но и функцию совместного распределения притока и оттока ликвидности по данной позиции в стакане, которая будет использована в завершающем подразделе при прогнозировании.



3.3.	Формирование прогноза

В качестве входных параметров факторной модели для определения параметров интенсивности для i-ой позиции были выбраны следующие показатели (каждое – W наблюдений назад):

Приток ликвидности соответствующей стороны рынка;

Отток ликвидности соответствующей стороны рынка;

Степень потенциального влияния на рынок;

Дисбаланс приказов для i-ой позиции.

Например, для ожидаемого притока ликвидности для первой позиции bid ожидаемый параметр интенсивности был представлен так:



Таким образом, в матрицу-генераторе используется линейная комбинация факторов, а  – качестве входа в многомерное распределение. На Рис.11 представлен типичный вид совместного распределения :



Характер эмпирической зависимости (из главы 2) был успешно отражён с помощью формализма копул. Более того, с течением времени связь эволюционирует, поэтому вид распределения может быть сначала скошенным в сторону оттока, затем в сторону приток ликвидности, в зависимости от рыночной ситуации в данный момент. 

После калибровки факторной модели и оценки совместного распределения притока и оттока ликвидности строится прогноз движения цены фьючерса на валютный курс доллар-рубль по вероятностному принципу:





где  – горизонт прогнозирования, – объём напротив позиции i , – доля времени в состоянии q. Фактически, это вероятность исполнения приказа.

Данный принцип базируется на том, что курс изменяется вследствие потребления объёма напротив той или иной доступной цены в стакане. Чтобы цена повысилась на два пункта вверх, необходимо, чтобы она повысилась сначала на один пункт, т.е. очистила ликвидность ask напротив лучшей цены продажи, а далее ещё на один – это отражено с помощью произведения вероятностей. Поскольку интенсивности означают число событий в единицу времени (в работе это котировка), то умножение интенсивности на горизонт прогнозирования даст оценку величины изменения объёма на данном горизонте, если его также домножить на долю времени пребывания в определенном состоянии, которое в работе определено как увеличение или уменьшение числа контрактов на единицу. Иными словами, если моментальный приток ликвидности составит +2, а горизонт равен 100, а доля равна 1/4, то в течение 100 котировок ожидается постановка ордеров объёма 50.




Заключение 

В рамках данного исследования была разработана микроструктурная модель прогнозирования динамики фьючерса на валютную пару доллар-рубль. Будучи одним из самых ликвидных контрактов на срочном рынке Московской Биржи, фьючерс на USDRUB торгуется в ходе двойного аукциона, реализуемого посредством книги лимитных приказов.

Микроструктурный подход к анализу финансовых рынков интегрирует теорию оценки активов в пространство торговых взаимоотношений, где массовые ожидания выражаются в форме приказов на покупку или продажу финансовых инструментов с учётом трансакционных издержек и институциональной структуры. Современные финансовые рынки характеризуются ускорением частоты сделок и росту популярности внебиржевых площадок. Однако валютный рынок стремится к большей прозрачности посредством увеличения активности торговли на биржах.

Анализ ликвидности контракта чрезвычайно важен как для решения задачи минимизации издержек, так и при прогнозировании движения цены. Количество доступных контрактов свидетельствует о глубине рынка. Глубина показывает, насколько может изменится цена при мгновенной покупке или продаже определённого количества контрактов, т.е. потенциальное влияние на цену. Также нужно учитывать дисбаланс приказов – индикатор настроения рынка. Состояние стакана для фьючерса на доллар-рубль очень нестабильно, в особенности вблизи лучших цен, а торговля проходит в различных режимах активности. Поставщики и потребители ликвидности влияют на процесс принятия решения, причём характер взаимной отдачи изменяется во времени. 

Упомянутые эмпирические факты были учтены в моделировании динамики торгов как марковской цепи с конечным числом состояний. Матрица-генератор была построена на основе показателей интенсивности, соответствующим притоку и оттоку ликвидности по данным позициям в стакане заявок. Скорости перехода между состояниями были оценены с помощью факторной модели на базе совместного распределения притока и оттока ликвидности, сконструированного с помощью копулы Клейтона.

Прогноз динамики курса базируется на вероятности ухода объёма с данной позиции в стакане, т.е. вероятности исполнения определённого количества контрактов в определённый промежуток времени.

