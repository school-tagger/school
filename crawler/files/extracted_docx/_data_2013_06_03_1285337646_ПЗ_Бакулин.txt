Правительство Российской Федерации

Федеральное государственное автономное образовательное учреждение 

высшего профессионального образования

«Московский институт электроники и математики

 Национальный исследовательский университет
Высшая школа экономики»





Факультет информационных технологий и вычислительной техники



Сетевые технологии

(Специализация)

Информационно-коммуникационные технологии

 (кафедра)









ДИПЛОМНАЯ РАБОТА

Разработка макета преобразователя интерфейсов Ethernet-RS232 для системы контроля и 

управления доступом TMSYS

(Название темы)







Выполнил

Студент группы № С-94

Бакулин Дмитрий Алексеевич

(Ф.И.О.)



Научный руководитель 



Доцент кафедры ИКТ, к.т.н., доцент, Гудков Ю.И.  

(должность, степень, звание, Ф.И.О.)



Консультант

Доцент кафедры ИКТ, к.т.н., доцент, Гудков Ю.И.

(должность, степень, звание, Ф.И.О.)









Москва, 2013


Московский институт электроники и математики НИУ ВШЭ

Кафедра Информационно-коммуникационных технологий







1. Тема проекта

Разработка макета преобразователя интерфейсов Ethernet-RS232 для системы контроля и управления доступом TMSYS



2. Задачи проекта

Разработка прикладного программного обеспечения для разрабатываемого модуля преобразователя Ethernet-RS232



3. Содержание работы

3.1. Обзорно-аналитическая часть

Анализ конфигурации системы контроля и управления доступом TMSYS

Сравнительный анализ аппаратных возможностей существующих технических решений преобразователей интерфейсов Ethernet-RS232

Тестирование NPort 5150

3.2. Разработка

Описание структурной схемы модуля преобразователя Ethernet-RS232

Выбор элементной базы

Описание универсальной отладочной системы ME UNI-DS 3

Реализация сетевого протокола обмена для разрабатываемого модуля преобразователя Ethernet-RS232

Реализация динамической настройки COM-порта

Реализация настройки сетевых параметров через COM-порт



3.3. Экспериментальная часть

Проверка совместимости макета и программного обеспечения

Тестирование готового устройства

3.4. Охрана труда

Исследование возможных опасных и вредных факторов при эксплуатации ЭВМ и их влияния на пользователей

Методы и средства защиты пользователей от воздействия на них опасных и вредных факторов



4. Перечень материалов, представляемых на защите

Пояснительная записка

Презентация

Демонстрация работы макета преобразователя интерфейсов Ethernet-RS232



5. Подписи сторон

Консультанты: 







Задание оформляется в двух экземплярах. 

Один экземпляр после утверждения темы выдается студенту для включения в пояснительную записку после титульного листа.

























Аннотация

В дипломном проекте проводится анализ системы контроля и управления доступом (СКУД) TMSYS. По результатам анализа, для улучшения эксплуатационных характеристик СКУД принимается решение о внедрения модулей-преобразователей Ethernet-RS232. Проводится обзор и сравнительный анализ готовых технических решений, удовлетворяющим требованиям СКУД. Выбирается одно из подходящих по техническим характеристикам устройств и проводится экспериментальная проверка применимости устройства в СКУД. По результатам тестирования принимается решение о разработке специализированного модуля-преобразователя Ethernet-RS232, т.к. внедрение протестированного существующего технического решения требует переработки программного обеспечения СКУД TMSYS. Формулируется задание на разработку модуля-преобразователя Ethernet-RS232 для СКУД TMSYS.

Модуль-преобразователь Ethernet-RS232 представляет собой программно-аппаратный комплекс. В специальной части дипломного проекта разрабатывается аппаратная и программные части преобразователя: выбирается подходящая элементная база под требования устройства, разрабатывается принципиальная схема, реализовывается поддержка сетевых протоколов и протокола обмена данными с модулями TMSYS.




Annotation

In the graduation project analyzes the access control systems (ACS) TMSYS. According to the analysis, make a decision on the on the introduction of module-converters Ethernet-RS232 to improve the performance of the ACS TMSYS. In accordance with the requirement of  the ACS TMSYS making a review and comparative analysis of ready technical solutions. Selects one of the matching capabilities of the device and perform experimental verification of the applicability of the device in the ACS TMSYS. According to test results the decision to develop a specialized module-converter Ethernet-RS232, because tested implementation of existing technical solutions require processing software of the ACS TMSYS. We formulate the task of designing the module-converter Ethernet-RS232 for the ACS TMSYS.

Module-converter Ethernet-RS232 is a hardware and software system. In special part of research project is developing a piece of software system, such as: Select an appropriate element base to the requirements of the device, developed schematic diagram, implement support for network protocols and data exchange protocol modules TMSYS.
















































Введение

В институте МИЭМ была создана и используется система контроля управлением доступа (СКУД) – TMSYS. Эта система отличается небольшой стоимостью и высокой надежностью. Система успешно функционирует долгое время, но в ходе эксплуатации были выявлены некоторые неудобства. Если модули системы находятся на близком расстоянии друг от друга, то одна рабочая станция позволяет получить доступ ко всем модулям. Но аудитории находятся на разных этажах, и прокладка кабелей не всегда возможна. Выходом из этой ситуации является распределенная система сетевого доступа, когда модули в одной аудитории связаны с ПК. Компьютер включен в сеть и на нем установлена сетевая служба. Для доступа к модулям системы требуется постоянная работа ПК. Использование компьютера, в качестве преобразователя интерфейсов, не является экономически обоснованно. Поэтому целесообразно интегрировать в систему преобразователи интерфейсов Ethernet-RS232, вместо рабочих станций.

Целью дипломной работы является повышение эксплуатационных характеристик распределенной системы контроля и управления доступом в учебные аудитории и лаборатории МИЭМ НИУ ВШЭ. 


Анализ системы контроля и управления доступом



Система контроля и управления доступом (СКУД) - это программно-аппаратный комплекс, предназначенный для решения следующих задач: создание индивидуального режима доступа сотрудников в помещения/объекты организации, идентификация сотрудника при входе и удаленное управление доступом.

Рис.1.1



Программная часть СКУД

Рис.1.2



Программное обеспечение системы включает инструментальные средства «TMSYS V5» для настройки и оперативного управления ресурсами системы в процессе эксплуатации. Кроме того для системы с помощью средств Microsoft Acess разработана база данных.



Полномочия

В программном обеспечении СКУД есть три уровня полномочий:

администратор;

служба персонала;

оператор.

Для каждого уровня полномочий есть возможность установить отдельный пароль. В ходе рассмотрения программного обеспечения будет указан необходимый уровень полномочий для каждого приложения.

	Приложение TM Config предназначено для настройки конфигурации системы администратором.

С помощью данного приложения возможно:

настроить параметры канала обмена, выбрав локальный или сетевой канал обмена;

зарегистрировать объекты, введя PIN-код объекта;

производить индивидуальную настройку конфигурации установленных на объектах системы модулей;

восстановить конфигурацию и настройки модуля в случае его замены;

корректировать объем информации о событиях в базе данных;

назначения пароля для других групп пользователей (служба персонала и операторы).

Минимальные необходимые полномочия: Администратор.

	Приложение TM Users предназначено для организации и настройки режима доступа пользователей к объектам службой персонала.

С помощью данного приложения возможно:

регистрировать подразделения;

регистрировать пользователей;

вводить коды ключей с помощью клавиатуры или персонификатора.

Минимальные необходимые полномочия: Служба персонала.

	Приложение TM Console предназначено для оперативного управления модулями в режиме online.

С помощью данного приложения возможно:

контролировать текущее состояние доступа к объекту;

дистанционно включать замок;

устанавливать необходимый режима доступа к объекту.

Минимальные необходимые полномочия: Оператор.

	Приложение TM Direct предназначено для копировании информации из буферов событий модулей в базу данных. Данное приложение работает в автоматическом режиме.

	Приложение TM Report предназначено для подготовки отчетов о хронологии всех событий, применения пользовательского ключа, действий операторов и нарушениях режима прохода.

Минимальные необходимые полномочия: Оператор.

	Приложение TM Output Control предназначено для формирования списка пользователей, которые на момент обновления  информации в базе данных не имели отметки о выходе с территории организации.

Минимальные необходимые полномочия: Оператор.

	Приложение TM  Work Time предназначено для учета рабочего времени сотрудников.

С помощью данного приложения возможно:

формировать отчеты об отметках прихода/ухода сотрудников;

формировать отчеты о фактическом и отмеченном рабочем времени сотрудников;

формировать отчеты об отработанных часах и неявках сотрудников.

Минимальные необходимые полномочия: Служба персонала.

	Приложение TM Work Object предназначено для учета времени, проведенного пользователями на отдельных объектах системы контроля и ограничения доступа.

С помощью данного приложения возможно:

формировать отчеты об отметках прихода/ухода сотрудников;

формировать отчеты о фактическом и отмеченном рабочем времени сотрудников;

формировать отчеты об отработанных часах и неявках сотрудников.

Минимальные необходимые полномочия: Служба персонала.

	Приложение TM Photo предназначено для вывода на экран сведений о владельце ключа, при его проходе на объект.

С помощью данного приложения возможно:

дистанционное управление проходом;

оперативное изменение режима доступа к объектам;

отображение на экране ПК информации о событиях на контролируемых объектах.

Минимальные необходимые полномочия: Оператор.

	Приложение TM Ext Photo выполняет аналогичные функции приложения TM Photo. Приложение TM  Ext Photo выводит сведения о проходе на объект в свою вспомогательную форму “Информация о событии”, создаваемую для каждого объекта.

Минимальные необходимые полномочия: Оператор.

	Приложение Serial Server TMSYS предназначено для обмена информацией между модулями СКУД, базой данных и программным обеспечением по сетевому каналу связи с использованием локальных сетей Ethernet. Данное приложение необходимо установить на рабочую станцию, к которой подключены модули по COM-порту, а сама рабочая станция включена в локальную сеть.

	База данных разработана с помощью средства Microsoft Acess и имеет расширение *.dbf. Для доступа к базе данных используется псевдоним dbTMAcces4. Использование псевдонима позволяет переместить базу данных на другой компьютер в локальной сети.



Функциональные возможности СКУД

	После рассмотрения программного обеспечения СКУД можно сформировать функции самой СКУД, которые в дальнейшем могут быть распределены между сотрудниками организации:

настройка конфигурации системы, восстановление конфигурации, организация каналов связи и добавление модулей;

добавление нового подразделения и/или пользователя;

ввод ключа пользователя, изменение уровня доступа (объект, день недели, время и т.д.);

формирование отчетов хронологии событий на объектах;

формирование отчетов для учета рабочего времени пользователей;

управление доступом к объекту;

контроль и подтверждение личности владельца пропуска, мониторинг пользователей находящихся на территории организации.



Роли пользователей системы

	Каждую функцию можно присвоить отдельной должности или отделу. Дополнительно к функциям СКУД на данную роль могут быть возложены дополнительные обязанности, связанные с функционированием СКУД в целом. Для каждой роли указан уровень полномочий, необходимый для выполнения своих функций. Данное разделение по ролям носит условный характер.

Таблица 1.1



Конфигурации СКУД в организации

	Рассмотрим несколько вариантов конфигурации СКУД в организации. Сложность конфигурации будет постоянно расти, будут указаны возможности и минусы каждой. Каждая из представленных конфигураций может быть взята за основу для реальной конфигурации в организации, в зависимости от необходимого функционала, размеров здания и количества объектов. При возможности конфигурации, будет максимальное разделение ролей по рабочим станциям. 



Конфигурация №1

Самая простая конфигурация. Несколько модулей СКУД последовательно соединены и подключены к рабочей станции по COM-порту. Для повышения нагрузочной способности COM-порта и увеличения длины линии связи необходимо использовать блок сопряжения. Длина линии связи от блока сопряжения до последнего модуля может достигать до 200 метров. Все программное обеспечение и база данных находятся на одной рабочей станции. Данная конфигурация подойдет для небольшой организации, располагающейся на одном этаже в небольшом здании, желательно с одной точкой входа. Основная функция данной СКУД при такой конфигурации является контроль доступа сотрудников на территорию объекта. Остальные функции системы труднореализуемые в полной мере.



Рис.1.3



Минусы конфигурации:  

ограничение линии связи до 200 метров, что делает невозможным обеспечить СКУД большое здание с несколькими этажами;

все программное обеспечение находится на одной рабочей станции, что накладывает все обязанности по настройке, обслуживанию и управлением СКУД на одного человека или же создает борьбу за доступ к рабочей станции;

сложность обеспечения безопасности и сохранности БД, возможность полного отказа системы при сбое.





Конфигурация №2

Рис.1.4



В данной конфигурации рабочая станция, подключенная к модулям, добавлена в локальную сеть организации. БД вынесена на сервер, который отвечает требованиям безопасности и хранения данных. Программное обеспечение, которое взаимодействует только с БД перенесено на отдельную рабочую станцию. Теперь с этой рабочей станции можно создавать различные отчеты: учета рабочего времени, хронология всех событий и действий пользователей. Вся настройка системы, управление и ввод ключей производится с локальной станции, подключенной  к модулям по COM-порту. Требования к организации и зданию не изменились. В данной конфигурации мы смогли выделить две роли (Бухгалтерия и Отдел безопасности), которые могут полноценно функционировать. Минусы конфигурации:  

ограничение линии связи до 200 метров, что делает невозможным обеспечить СКУД большое здание с несколькими этажами;

настройка и управление СКУД возможны только с одной рабочей станции.



Конфигурация №3

Рис.1.5



В данной конфигурации будет использовано приложение Serial Server TMSYS, которое позволяет осуществлять сетевой доступ к модулям. Таким образом, все остальные функции системы можно разнести по ролям.

Данная конфигурация подходит для организаций в многоэтажных, больших зданий или нескольких зданий. Она позволяет реализовать полный функционал СКУД. Рабочие станции, подключенные к модулям по COM-порту не всегда можно и удобно использовать для какой-либо роли. Необходима работа рабочих станций с COM-портом минимум во время всего рабочего дня, желательно круглосуточно. Минусы конфигурации:  

необходимость наличия и постоянной работы рабочих станций с COM-портом;

возможная ограниченность функциональных возможностей рабочих станций с COM-портом из-за необходимости размещения в местах, удовлетворяющим требованиям размещения модулей.



Конфигурация №4

Рабочие станции с COM-портом можно заменить на SerialtoEthernet преобразователи (рис 1.6). Это позволит: 

уменьшить затраты на покупку рабочих станций (низкая стоимость преобразователя, нет затрат на ОС);

понизить энергопотребление системы в целом, что даст возможность сделать аппаратную часть системы незаметной;

упростит интеграцию и обслуживание системы; 

Данное решение не повлияет на функциональные возможности СКУД.

Рис.1.6



Для выбора подходящего SerialtoEthernet преобразователя необходимо рассмотреть требования к протоколу обмена информации в СКУД.



Пакет обмена данными

Первые 8 байт используются для выбора устройства.



8 байт: PIN − 3 байта, остальные поля по 1 байту.

ID − присваивается системой после добавления устройства;

КОП − код операции;

указатель −  адрес памяти;

PIN − каждый сетевой модуль имеет уникальный PIN-код из 3 байт;

CRC − контрольная сумма.

Передача пакета осуществляется с поддержкой 9-го бита. У байта ID 9-й бит установлен в “1”, у остальных байтов в “0”. Все модули в состоянии ожидания обрабатывают только те байты, у которых 9-й бит установлен в “1” т.е. только ID, остальные байты игнорируются до тех пор, пока модули не увидят свой ID. Последующие пакеты по 8 байт являются данными и передаются с “0” 9-м битом.

Таким образом, одним из требований к преобразователю SerialtoEthernet является поддержка 9 бита в режимах Mark(1) и Space(0).















Анализ существующих преобразователей интерфейсов Ethernet-RS232



Параметры устройств

Были рассмотрены преобразователи по следующим параметрам (см. Приложение 1):

кол-во портов;

поддержка RS-422/485;

поддержка различных скоростей;

использование режима 9-го бита;

доступ к настройкам COM-порта;

наличие виртуального COM-порта;

цена.

При анализе можно выделить несколько классов устройств:

однопортовые;

устройства малой функциональности − ограничения по скорости, режимам работы, без корпуса или миниатюрные, низкая стоимость (<100$);

универсальные − полная поддержка режимов работы COM-порта (возможна поддержка RS-422/485). Стоимость от 100$ до 200$.

Многопортовые.

Универсальные − полная поддержка режимов работы COM-порта (возможна поддержка RS-422/485), наличие корпуса, обычно до 4 COM-портов. Стоимость от 225$ до 400$;

Промышленные − устройства с полной поддержкой режимов работы COM-порта, форм-фактор для установки в серверные стойки, высокая стоимость (>1000$).

Для интеграции в СКУД подходят устройства из категории однопортовые-универсальные. Было выбрано устройство из этой категории – MOXA NPort 5150.



Тестирование NPort 5150

Устройство представляет собой 1-портовый асинхронный преобразователь из RS-232/422/485 в Ethernet. Поддержка протоколов(ICMP, IP, TCP, UDP, DHCP, BootP, Telnet, DNS, SNMP, HTTP, SMTP, NTP). Его возможности:

настройка устройства через Telnet, Web-интерфейс или через программу;

передача данных на несколько устройств (до 4х) одновременно;

встроенная поддержка 9-го бита (чет, нечет, 0 или 1);

Аппаратный метод управления и синхронный режим передачи данных;

Виртуальный Com-порт;

TCP/UPD-server;

TCP/UDP-client.

Было произведено тестирование устройства и попытка внедрения в СКУД. В ходе тестирования обнаружилось:

устройство не поддерживает необходимый протокол обмена, т.е. нет возможности динамического управления 9 битом;

устройство не отображает COM-порт в диспетчере устройств, что не позволяет создать локальный канал обмена по COM-порту;

в программное обеспечение устройства входит библиотека для управления работы COM-порта, т.е. имеется возможность переработать программное обеспечение TMSYS для работы с этим устройством.

Принимается решение о создании собственного устройства-преобразователя serialtoethernet, исходя из следующего:

для использования NPort 5150 необходимо переработать отлаженное программное обеспечение TMSYS;

риск в долгосрочной перспективе: смена прошивки и библиотеки устройства, прекращения выпуска устройства производителем;

экономические причины: поставщик СКУД не имеет прибыли с устройства при покупке у другого производителя, но затрачивает средства на разработку программного обеспечения.

Поэтому разработка специализированного преобразователя интерфейсов является актуальной задачей. Это позволит исключить необходимость переработки программного обеспечения системы.



Требования к устройству-преобразователю

Сформирован следующий список требований: 

поддержка протоколов ARP, IP, ICMP, TCP;

поддержка протокола обмена данными с сетевой версией TMSYS;

тестирование линии связи: определение допустимой скорости обмена в линии, проверка доступности устройств;

программное обеспечение для настройки и тестирования устройства;

интерфейсы: ethernet, RS 232;

настройка сетевых параметров через COM-порт;

программируемый статический IP адрес, MAC адрес;

оперативная настройка скорости COM-порта и формата передачи данных: 8, 9 бит;

прием и отправка блока данных из COM-порта, размером от 1 до 256 байт;

питание − внешний сетевой адаптер, ток потребления не более 1А, напряжение 5В.





Разработка аппаратной части 



Выбор элементной базы

Для реализации модуля-преобразователя Ethernet-RS232 на базе микроконтроллера (МК) были выбраны следующие элементы:

MAX232 − для обеспечения логической и электрической совместимости между RS232 и МК;

74HCT245 − преобразователь логических уровней, обеспечивает электрическую совместимость enc28j60 и МК;

enc28j60 – сетевой контроллер;

PS 05-5 – блок питания (5В, 1А, 5Вт).

Выбор enc28j60 обусловлен: 

наличием буфера пакетов (8кб);

возможностью передачи данных по интерфейсу SPI;

встроенным фильтром пакетов (по MAC-адресу и размеру пакета);

автоматическим расчетом контрольной суммы (CRC);

поддержкой стандарта 10BASE-T;

режим передачи данных Full-Duplex .

	

Выбор ядра системы

	Учитывая требования, приведенные в разделе 2.3, был выбран микропроцессор 51 семейства Intel − AT89S8253. Его характеристики:

12Кб программной памяти;

программирование процессора по шине SPI;

2Кб EEPROM (энергонезависимая память);

128 байт прямоадресуемой оперативной памяти;

128 байт косвенноадресуемой оперативной памяти;

3 16-битных счетчика/таймера;

7 видов прерываний (в том числе прерывания по COM-порту);

4-х уровневая система приоритетов прерываний;

последовательный интерфейс UART (универсальный асинхронный приемопередатчик);

режим 9-битного обмена UART;

встроенная поддержка SPI;

16 байт побитной адресации;

встроенный тактовый генератор с частотой до 20МГц (10х2).

Это однокристальный 8-разрядный микроконтроллер. Архитектура – Гарвардская. Ключевой особенностью данной архитектуры является физическое разделение памяти программ, данных и стека. Плюсами этой архитектуры, по сравнению с архитектурой Фон-Неймана, являются:

доступ к областям памяти происходит по отдельным линиям;

физическое разделение памяти программ, данных и стека;

параллельное  чтение/запись.

Но имеется и недостаток – неэкономно расходуется память.



Разработка принципиальной схемы

В качестве ядра системы используется микроконтроллер AT89S8253. Он выполняет функции связующего звена между COM-портом и Ethernet. К нему подключены: 

RX232 – прием данных из COM-порта;

TX232 – передача данных в COM-порт;

OSC1, OSC2 – вход/выход тактового генератора;

ETH-RST – перезагрузка enc28j60;

ETH-WOL – выход из спящего режима, по сигналу из LAN;

ETH-CS – выбор микросхемы для передачи данных по SPI;

ETH-INT – прерывание по внешнему входу INT;

MISO – прием данных от enc28j60 по SPI;

MOSI – передача данных в enc28j60 по SPI;

SCK – тактовый сигнал для синхронизации с enc28j60;

VCC − +5B;

GND – земля.

Входные и выходные разъемы – DE-9 и RJ-45. Питание платы от внешнего адаптера.

Рис.3.1









Описание отладочного стенда UNI-DS3

Для разработки и отладки программного обеспечения преобразователя интерфейсов Ethernet-RS232 был выбран универсальный лабораторный стенд UNI-DS3 фирмы MikroElektronika. Этот стенд включает в себя универсальный разъем, в который может быть установлен выбранный нами микроконтроллер – AT89S8253. Так же на плате установлены: 

разъем RJ-45 и микросхема enc28j60;

разъем DE-9 и микросхема MAX232; 

USB программатор;

стабилизатор напряжения питания;

DIP-переключатели SW1-SW4 для включения/выключения модулей стенда.

Для использования стенда в качестве преобразователя интерфейсов нужно произвести следующие действия: 

вставить микроконтроллер в универсальный разъем;

подключить кабели в разъемы DE-9 и RJ-45;

1 переключатель SW1 установить в положение ON.

1, 2, 3, 4 и 5 переключатели SW2 установить в положение ON;

5 и 6 переключатели SW3 установить в положение ON;

4, 5 и 6 переключатели SW4 установить в положение ON;

На данном этапе, питание и программирование платы будет осуществляться по USB. 











Разработка программной части



Выбор инструментов реализации

Для реализации системы будет использоваться следующий инструментарий:

dropbox – используется для хранения и синхронизации актуальной версии проекта;

microC PRO for 8051 – интегрированная среда разработки;

язык программирования С.



Dropbox

Dropbox – бесплатный сервис, который обеспечивает доступ к файлам с любого компьютера. Есть функция общего доступа. Она позволяет предоставить доступ к своим файлам другому пользователю. Удобно для совместной работы над одним проектом. 



MicroC PRO for 8051

Данная среда разработки предназначена для трансляции программы, составленной на языке С в программу на языке Ассемблер. В неё входят:

текстовый редактор;

компилятор;

отладчик;

просмотр статистики;

универсальный синхронно-асинхронный приемопередатчик;

различные библиотеки;

примеры.

Удобство написания программного кода, гибкая работа с проектами, легкая настройка параметров, встроенный программатор, множество примеров и просмотр кода на ассемблере – все это плюсы данной среды разработки.



Язык С

Выбор языка обусловлен:

опыт  написания программ на данном языке;

стандартизированный язык (ANSI) – упрощает портирования программы на разные устройства;

поддержка многими компиляторами;

популярный язык – большая база пользователей с множеством примеров программ;

компилируемый язык имеет преимущество в скорости исполнения;



Разработка алгоритма

Алгоритм основной программы

В основном блоке программы происходят основные инициализации системы:

включается приемник и передатчик COM-порта;

настраивается и включается таймер Т2. Он обеспечивает синхронизацию скоростей внешнего устройства и преобразователя интерфейсов Ethernet-RS232;

настраивается таймер Т1. Его задача вызывать обработку пакетов, пришедших из Ethernet. Обработка происходит примерно каждые 70мс;

настраивается и включается интерфейс SPI – последовательный синхронный стандарт передачи данных. Обеспечивает сопряжение микропроцессора и сетевого контроллера;

проверяется, подключен ли сетевой кабель. Если кабель не подключен, происходит настройка сетевых параметров;

инициализируется и включается сетевой контроллер enc28j60;

Рис.4.1

                       

разрешаются прерывания по последовательному порту и таймеру Т1, и устанавливается приоритет прерываний;

запускается бесконечный цикл.



Алгоритм обработки прерываний по таймеру

В прерывании по таймеру Т1 обрабатывается буфер сетевого контроллера enc28j60. Программа выполняет:

останавливает таймер Т1;

сбрасывает счетчики таймера;

проверяет, есть ли пакеты в буфере. При наличии – обрабатывает;

запускает таймер;

выходит из прерывания.

Рис.4.3

                                               



Алгоритм обработки прерываний по последовательному порту

В прерывании по последовательному порту обрабатываются данные COM-порта:

если установлен бит приемника:

записывается 9-бит и полученный байт в буфер FIFO;

сбрасывается бит приемника;

выход из прерывания.

если установлен бит передатчика:

устанавливается флаг отправленного сообщения;

сбрасывается бит приемника;

выход из прерывания.

Рис.4.2





Организация памяти устройства

Энергонезависимая память EEPROM

EEPROM (электрически стираемое перепрограммируемое постоянное запоминающее устройство) – энергонезависимый массив памяти, отделённый от памяти данных ОЗУ и памяти программ, который предназначен для долговременного хранения записанных данных.

Было принято решение, хранить параметры настройки устройства в энергонезависимой памяти:

MAC-адрес;

IP-адрес;

уникальный номер устройства (ID);

год выпуска устройства.

MAC-адрес и IP-адрес − это сетевые параметры устройства. Поэтому изменение этих параметров должно быть предоставлено пользователю системы.

ID и год выпуска являются информацией для производителя, позволяющие контролировать свою продукцию после продажи устройства. Пользователь системы должен иметь возможность только прочитать эту информацию.

Длина сетевых параметров составляет 6 и 4 байта соответственно для MAC-адреса и IP-адреса, длина уникального номера равняется 12 байтам.

Значение года выпуска можно закодировать как с помощью 1 байта, прибавляя 1 байт к константе, например 2000, так и с помощью 2 байт, считывая значение с двухбайтового числа. Принимается решение использовать под год выпуска 2 байта, как более простое и понятное.

Таким образом, в энергонезависимой памяти устройство необходимо использовать 24 байта.





Рис. 4.4



Для разделения доступа к сетевым параметрам и информацией для производителя, а также возможности закончить настройку в любой момент созданы следующие команды:

прочитать все данные;

записать все данные;

записать сетевые параметры;

закончить настройку.



Оперативная память RAM

RAM (random access memory) – энергозависимая часть системы,	 в которой временно хранятся данные и команды, необходимые МК для выполнения операций.

Общий объем оперативной памяти – 256 байт. Она состоит из двух частей: внутреннего ОЗУ размером 128 байт и памяти, выделяемой для регистров специальных функций (Special Function Registers). Архитектура внутренней памяти данных 8051 позволяет обращаться к отдельным битам данных в специально выделенной области внутреннего ОЗУ, начиная с адреса 0x20 и заканчивая 0x2F. Во внутреннем ОЗУ микроконтроллера 8051 выделены 4 банка регистров общего назначения.

Регистры специальных функций предназначены для управления ходом вычислительных операций, а также отвечают за инициализацию, настройку и управление портами ввода/вывода, таймерами, последовательным портом. Кроме того, регистры специальных функций содержат информацию о приоритетах прерываний, а также биты управления разрешением прерываний. Среди регистров специального назначения есть регистры, выполняющие функции адресации данных, находящихся в памяти. К ним относятся 8-разрядный указатель стека (SP) и регистр-указатель DPTR.

Двухбайтный регистр-указатель данных DPTR обычно используется для фиксации 16-разрядного адреса в операциях с обращением к косвенной памяти. 

Было принято решение расположить сетевой буфер (ethernet) и буфер FIFO (COM) в косвенной памяти. Размер сетевого буфера – 82 байта, размер FIFO буфера – 20 байт. Оставшиеся 28 байт будут использоваться под стек.

Для реализации сетевого протокола обмена рассмотрим протоколы:

ARP;

IP;

ICMP;

TCP.



Протокол ARP

ARP − протокол сетевого уровня, предназначенный для определения  по известному .

Он классифицируется как протокол второго уровня сетевой модели OSI. Длина arp-пакета 42 байта.

Ответ на arp-запросы является одной из приоритетных задач, для успешной передачи данных по сети. При приеме пакета ARP-request (см. рис.4.5) необходимо:

поменять MAC-адрес источника на MAC-адрес назначения;

в качестве адреса источника установить свой MAC-адрес;

в код операции записать 00 02;

отправить пакет.



Рис.4.5





Протокол IP

IP − межсетевой протокол. Относится к маршрутизируемым протоколам сетевого уровня семейства TCP/IP. IP объединяет сегменты сети в единую сеть, обеспечивая доставку данных между любыми узлами сети. Он классифицируется как протокол третьего уровня по . IP не гарантирует надёжной доставки пакета до адресата.

 Гарантию безошибочной доставки пакетов дают некоторые протоколы более высокого уровня —  сетевой модели OSI, — например, , которые используют IP в качестве транспорта.

При приеме пакета анализируется поле protocol, заголовка IP-пакета (рис.4.6). В зависимости от значения, обрабатывается либо ICMP-пакет, либо TCP-пакет.

Рис.4.6





Протокол ICMP

ICMP – сетевой протокол, входящий в стек протоколов TCP/IP. Протокол ICMP будет использоваться для ответа на запросы ICMP Echo-Request (см.рис.4.7). Эти запросы посылает утилита ping. Её основное назначение – проверка соединений в сетях.

Рис.4.7



При приеме пакета ICMP Echo-Request необходимо:

изменить поле type на 0;

пересчитать контрольную сумму;

поменять IP-адрес источника на IP-адрес назначения;

в качестве адреса источника установить свой IP-адрес 

поменять MAC-адрес источника на MAC-адрес назначения;

в качестве адреса источника установить свой MAC-адрес;

отправить пакет.



 Протокол TCP

TCP (протокол управления передачей) − один из основных , предназначенный для управления  в сетях и подсетях . Выполняет функции протокола  . Протокол TCP перед передачей данных устанавливает соединение. За счёт этого есть уверенность в достоверности получаемых данных. В случае потери данных осуществляет повторный запрос данных и устраняет дублирование, при получении двух копий одного пакета.

При приеме TCP пакета анализируется поле Flags (рис.4.7), и в зависимости от его значения выполняется то или иное действие:

если приняли пакет с флагом SYN – запрос на установление соединения. Отвечаем с флагами SYN + ACK. Ждем в ответ ACK. Соединение установлено;

если приняли пакет с флагом ACK или PSH + ACK – посылка с данными. Обрабатываем посылку и отправляем в ответ ACK;

если приняли пакет с флагом FIN + ACK – запрос на закрытие соединения. Отправляем в ответ FIN + ACK. Ждем в ответ ACK. Закрываем соединение;

если приняли пакет с флагом RST – запрос на сброс соединения. Закрываем соединение.







Рис.4.7



После установления соединения и приема пакета, произведя деинкапсуляцию, мы доберемся до сетевого протокола обмена.  































Экспериментальная часть



Эксперимент «Настройка сетевых параметров через COM-порт» 

Подключаем компьютер к универсальному отладочному стенду ME UNI-DS 3 по COM-порту. Питание по USB.

Рис.5.1



включаем отладочный стенд, сетевой кабель не подключен;

производим настройку с помощью приложения NetSetCon;

Рис.5.2









подключаем сетевой кабель;

проверяем доступность по сети устройства с помощью утилиты ping;

Рис.5.3



проверяем соответствие MAC и IP адресов устройства в таблице ARP;

Рис.5.4



повторяем пункты 1-3 с другими сетевыми параметрами.



Эксперимент «Динамическая настройка COM-порта»

Подключаем компьютер к универсальному отладочному стенду ME UNI-DS 3 по COM-порту и Ethernet. Питание по USB.

Рис.5.5



используем нуль-модемный кабель для подключения;

производим настройку сетевых параметров;

отправляем команду открытия COM-порта с помощью эмулятора Emulator TMSYS,  с заданным параметром скорости;

Рис.5.6



отправляем посылку данных в COM-порт с проверкой линии связи, ожидаем сообщения об успешной отправке;



Рис.5.7



повторяем пункты 3-4 с другими параметрами COM-порта.



Эксперимент «Открытие и закрытие COM-порта»

Для подключения ПК и стенда используем схему, показанную на рисунке 5.5.

производим настройку сетевых параметров;

отправляем команду открытия COM-порта;

отправляем посылку данных, получаем подтверждение успешной отправки данных; 













Рис.5.8



отправляем команду закрытия COM-порта;

Рис.5.9



отправляем посылку данных, получаем сообщение о том, что порт закрыт.

Рис.5.10





Эксперимент «Чтение данных из COM-порта»

Для подключения ПК и стенда используем схему, показанную на рисунке 5.5.

производим настройку сетевых параметров;

отправляем команду открытия COM-порта;

используя UART-терминал на ПК, отправляем посылку данных с 9-м битом marker(1);

















Рис.5.11



отправляем команду чтения данных; сверяем полученные и отправленные данные;

Рис.5.12



Повторяем эксперимент с другими данными.



Эксперимент «Отправка данных в COM-порт»

Для подключения ПК и стенда используем схему, показанную на рисунке 5.5.

производим настройку сетевых параметров;

отправляем команду открытия COM-порта;

отправляем посылку данных;

Рис.5.13



используя UART-терминал на ПК, получаем посылку, сверяем полученные и отправленные данные.

















Рис.5.14



После проведения всех экспериментов можно отметить успешное выполнение устройством всех поставленных задач. 





































Охрана труда



Исследование возможных опасных и вредных факторов при эксплуатации ЭВМ и их влияния на пользователей

Охрана труда – это система законодательных актов, технических, лечебно-профилактических, организационных, социально-экономических и гигиенических мероприятий и средств, обеспечивающих сохранение  здоровья, безопасности и работоспособности человека  в процессе труда. 

Приоритетной задачей охраны труда является уменьшение вероятности травмирования или заболевания работника, обеспечение комфорта и   максимальной  производительности труда.

Использование ПК вредит здоровью работника. К концу рабочего дня люди, работающие за компьютером, ощущают: боли в мышцах шеи, кистях, пальцах, спине, пояснице, головную боль, покраснение и слезоточивость глаз и т.п. Каждодневная эксплуатация ПК может привести к сколиозу, кожным воспалениям, частичной потере зрения, мигреням, и другим нежелательным явлениям, которые уменьшают или сводят к нулю трудоспособность работника, а также подрывают здоровье людей. В будущем могут развиться такие заболевания как: нарушение сна, астенопия, снижение концентрации внимания, боли в спине и шее, повышенная возбудимость и депрессивные состояния, запястный синдром, головокружения, тендениты, хронические головные боли, стенокардия и различные стрессовые состояния, сыпь на коже лица.

Дисплеи (мониторы) наносят наибольший вред здоровью, особенно дисплеи с электронно-лучевыми трубками. Они являются потенциальными источниками  мягкого  рентгеновского,  ультрафиолетового,  инфракрасного, радиочастотного электромагнитного импульса.

Работа с ПК сопряжена с появлением опасных и вредных факторов.

Опасный производственный фактор − производственный фактор, воздействие которого на работающего в определенных условиях приводит к травме, острому отравлению или другому внезапному резкому ухудшению здоровья, или смерти.

Вредный производственный фактор − производственный фактор, воздействие которого на работающего в определенных условиях может привести к заболеванию, снижению работоспособности и (или) отрицательному влиянию на здоровье потомства.

Конфигурация ПК:

системный блок на основе процессора Intel Core i7 3,66Ггц, жесткого диска SATAIII, памяти DDR3 4GB и видеокарты Nvidia GF GT 430;

цветной монитор Samsung SyncMaster P2350; 

частота обновления экрана при максимальном разрешении - 60 Гц;

лазерный принтер HP Laserjet pro p1102;

Вредные факторы при эксплуатации ПЭВМ: 

питание производится от сети 220В, следовательно, существует вероятность поражения электрическим током, т.к. безопасное напряжение для человека всего 40В.

благодаря кадрово-частотной развертке (85Гц – 42кГц) создается изображение на ЭЛТ, следовательно, человек попадает в зону электромагнитного излучения низкой частоты;

ультрафиолетовое излучение является вредным фактором, при длительной работе за монитором;

электронно-лучевые устройства, из-за статического электричества, притягивают к экрану пыль и мелкие частицы. Из-за них ухудшается видимость, появляются заболевания кожи и дыхательных путей, при попадании на лицо или в легкие человека. 

После исследования вредных факторов, можно выделить следующие группы опасных и вредных факторов: 

статическое электричество;

поражение электрическим током;

ультрафиолетовое излучение;

электромагнитное излучение.



Методы и средства защиты пользователей от воздействия на них опасных и вредных факторов

Методы и средства защиты от поражения электрическим током

Зануление является основной мерой защиты от поражения людей электрическим током в случае прикосновения к корпусам электрооборудования и металлическим конструкциям, оказавшимся под напряжением вследствие повреждения изоляции или однофазного короткого замыкания в электроустановках напряжением до 1000В в сети с глухозаземленной нейтралью.

Занулением называется преднамеренное электрическое соединение металлических элементов электроустановки (корпуса электрооборудования, кабельные конструкции, стальные трубы и др.), нормально не находящихся под напряжением, но могущих в процессе эксплуатации оказаться под напряжением, с глухозаземленной нейтралью источника питания с помощью нулевого рабочего или защитного провода.

Такое электрическое соединение, будучи надежно выполненным, всякое замыкание токоведущих частей на указанные металлические части электроустановки превращает в короткое замыкание с целью вызвать больший ток, способный обеспечить срабатывание защиты (предохранители, автоматы и т. п.) и отключение поврежденной установки от питающей сети.

 Надежное зануление обеспечивает быстрое отключение аварийного участка, снижение напряжения прикосновения.

Методы и средства защиты от ультрафиолетового излучения

Ультрафиолетовые (УФ) излучения относятся к оптическому диапазону электромагнитных волн.

В зависимости от интенсивности и длины волны УФ-излучение действует двояко на живые организмы. С одной стороны, малые дозы УФ-облучения оказывают благотворное влияние на человека и животных, способствуя образованию витаминов группы D. С другой стороны, УФ-облучение оказывает вредное (губительное) действие на живые организмы. Установить границу дозволенного и губительного в ряде случаев бывает очень сложно. Физиологическое действие УФ-излучения проявляется в следующем: 

УФ-А приводит к флюоресценции; 

УФ-В вызывает изменения в составе крови, кожи, воздействует на нервную систему; 

УФ-С действует на клетки.

УФ-излучение от производственных источников, в первую очередь электросварочных дуг, может стать причиной острых и хронических профессиональных поражений. Наиболее подвержен действию УФ-излучения зрительный анализатор. УФ-излучение производственных источников способны изменять газовый состав атмосферного воздуха из-за его ионизации. При этом в воздухе образуются высокотоксичные газы озон и оксиды азота, представляющие большую профессиональную опасность, особенно при сварочных работах в ограниченных, плохо проветриваемых помещениях.

Защита от интенсивного облучения ультрафиолетовыми лучами достигается: 

рациональным расположением рабочих мест;

соблюдение расстояния до экрана;

экранированием источников излучения;

экранированием рабочих мест;

средствами индивидуальной защиты.

Наиболее рациональным методом защиты считается экранирование (укрытие) источников УФ излучений. В качестве материалов для экранов применяют обычно непрозрачные металлические письма или светофильтры. К средствам индивидуальной защиты относят: 

спецодежду (костюмы, куртки, белые халаты); 

средства для защиты рук (тканевые перчатки), лица (защита щитки) и глаз (очки со светофильтрами);

средства для защиты кожи.



Методы и средства защиты от электромагнитного излучения

Для уменьшения влияния электромагнитного излучения следует применять ряд защитных мероприятий:

организационные;

рациональное размещение излучающих и облучающих объектов;

ограничение места и времени в поле при эксплуатации.

инженерно-технические;

коллективная защита;

дифракционные экраны;

лесонасаждения;

подъем антенн и диаграмм;

секторное блокирование излучения сканеров.

индивидуальная защита;

от внутренних излучений;

от внешних излучений.

локальная защита;

радиозащитные костюмы;

средства частичной защиты (очки, халаты, фартуки и т.д.).

лечебно-профилактические.



Методы и средства защиты от статического электричества

Статическое электричество — совокупность явлений, связанных с возникновением, сохранением и релаксацией свободного электрического заряда на поверхности или в объеме диэлектриков или на изолированных проводниках. 

Основные способы защиты:

ионизация воздуха;

отвод зарядов путем заземления оборудования и коммуникаций;

применение антистатических веществ и одежды;

увеличение относительной влажности воздуха до 75 %.

Вывод

Выбранные методы и способы защиты от опасных и вредных факторов, обеспечивают защиту пользователей, работающих с вычислительной техникой.








Заключение

В результате разработки макета и программного обеспечения преобразователя интерфейсов Ethernet-RS232 для системы контроля и управления доступом TMSYS, в рамках данного дипломного проекта, стало возможным интегрировать преобразователь интерфейсов в систему контроля и управления доступом без внесения изменений в программное обеспечения TMSYS и аппаратную часть системы.

Разработанный преобразователь интерфейсов позволяет построить распределенную систему сетевого доступа, без использования рабочей станции в качестве переходника Ethernet-RS232. Данный шаг заметно упрощает процесс создания или модернизации/расширения системы контроля и управления доступом TMSYS.

Разработанный программно-аппаратный комплекс позволит улучшить эксплуатационные качества системы контроля и управления доступом TMSYS.






Список использованной литературы



Вайнштейн Л. И. Меры безопасности при эксплуатации электроустановок потребителей - Москва: Энергия. 1977. − 176 с.

Ветошкин А. Г. Теоретические основы защиты окружающей среды/ Учебное пособие − Москва: Абрис. 2012. − 397 c.

ГОСТ 12.0.002-80 Система стандартов безопасности труда// Термины и определения: Межгосударственный стандарт. 1990. − 24 c.

ГОСТ 12.1.018-93 Система стандартов безопасности труда/Пожаровзрывобезопасность статического электричества // Общие требования. − Минск: Межгосударственный Совет по стандартизации, метрологии и сертификации. 1994. − 5 c.

ГОСТ 12.1.030-81 Электробезопасность. Защитное заземление. Зануление: Государственный стандарт Союза ССР. 1982. – 24 с.

Жидецкий В. Ц., Джигирей В. С. и Мельников А. В. Основы охраны труда - Львов: Афиша. 2000. − 351 с.

Павловская Т.А. С/С++ Программирование на языке высокого уровня. − Москва: Питер. 2005. − 460 с.

Сташин 	В.В., Урусов А.В. и Мологонцева О.Ф. Проектирование цифровых устройств на однокристальных микроконтроллерах. – Москва: Энергоатомиздат. 1990. – 226 с.

Магда Ю.С. Микроконтроллеры серии 8051: практический подход. – Москва: ДМК Пресс. 2008. – 228 с.

Уэйт М., Прата С. и Мартин Д. Язык Си Руководство для начинающих / перевод с английского Горинович Л.Н. и Явниловича В.С.; под ред. д-ра техн. наук Трахтенгерца Э.А. – Москва: Мир. 1988. – 345 с.

Олифер В. Г. и Олифер Н. А. Компьютерные сети. Принципы технологии, протоколы. – СПб: Питер. 2001. 672 с.

Ссылки на Web-сайты

Atmel 8051 Microcontrollers Hardware  Manual 

AT89S8253 Data Sheet 

ENC28J60 Data Sheet 

ME UNI DS-3 Manual 

ME UNI DS-3 Schematic 

MAX232 Data Sheet 

RS-232 

ARP 

IP 

ICMP 

TCP 






Приложение 1. 









